# Muscle-Driven Standing Balance Strategy

A MATLAB/Simulink simulation of **human standing balance** using physiologically realistic **Hill-type muscle models**. The model simulates a multi-segment body (foot, leg, torso, arm) in Simscape Multibody, controlled by soleus (SOL) and tibialis anterior (TA) ankle muscles, a hip PD controller, and a shoulder PD controller — responding to an external push disturbance.

---

## Overview

This project models the **ankle strategy** for standing balance: when pushed, the human body recovers primarily through ankle torque generated by antagonistic muscles (soleus and tibialis anterior). The simulation combines:

- A **Simscape Multibody** rigid body model of the human body (foot, heel, leg, torso, arm) with revolute joints at ankle, hip, and shoulder
- **Hill-type muscle models** for SOL and TA, composed of a Contractile Element (CE), Passive Element (PE), and Series Elasticity (SE)
- **PD controllers** at the hip and shoulder joints
- A **bang-bang controller** at the hip for rapid response
- A **push force disturbance** applied to the torso to test balance recovery

---

## Repository Structure

```
Standing-Strategy/
│
├── Standing_Strategy.slx                  # Simulink/Simscape Multibody model
├── params.m                               # All physical and control parameters
│
└── Muscle Model Functions/
    ├── CE_force_length_relation.m         # Active CE force-length curve
    ├── CE_force_velocity_relation.m       # CE force-velocity curve (Hill equation)
    ├── CE_inverse_force_velocity_relation.m  # Inverse FV relation (velocity from force)
    ├── PE_force_length_relation.m         # Passive CE force-length curve
    └── SE_force_length_relation.m         # Series elasticity force-length curve
```

---

## Requirements

- **MATLAB R2023a or later**
- **Simulink**
- **Simscape** + **Simscape Multibody** toolboxes
- **Deep Learning Toolbox** (for ReLU Layer blocks used in muscle model activation)

---

## How to Run

1. Run `params.m` to load all parameters into the workspace:
   ```matlab
   params
   ```
2. Open and simulate the model:
   ```matlab
   open('Standing_Strategy.slx')
   sim('Standing_Strategy')
   ```

---

## Simulink Model Structure (`Standing_Strategy.slx`)

### Top-Level Subsystems

| Subsystem | Description |
|-----------|-------------|
| `Ankle joint` | Revolute joint with Simscape contact forces, reads ankle torque from muscle model |
| `Ankle Control` | Routes ankle angle/velocity to muscle models and outputs total ankle torque |
| `Muscle models` | Contains `SOL muscle model` and `TA muscle model` — full Hill-type implementations |
| `Hip Joint` | Revolute joint for hip with spatial contact and rigid transforms |
| `Hip joint PD control` | PD controller for hip + bang-bang controller for rapid disturbance response |
| `Shoulder joint` | Revolute joint for shoulder |
| `Shoulder PD control` | PD controller for shoulder joint |
| `Leg` | Brick solid body segment |
| `Torso` | Brick solid body with external push force applied |
| `Foot` | Brick solid with spatial contact force (ground contact) |
| `Heel` | Brick solid with spatial contact force (heel contact) |
| `Arm` | Brick solid body segment |
| `Bang Bang control` | Hip bang-bang controller with step inputs for rapid torque switching |

### Muscle Model Internals (`SOL / TA muscle model`)

Each muscle model subsystem implements the full Hill model:

```
Inputs:  s [ ]     — neural excitation (0–1)
         lm [m]    — total muscle-tendon length

Outputs: fm [N]    — muscle force
         lce [m]   — CE length
         vce [m/s] — CE velocity
         lse [m]   — SE (tendon) length
         a [ ]     — activation
```

The internal signal flow: excitation → activation (1st-order dynamics) → `CE_force_length` × activation → `inverse CE_force_velocity` → CE velocity → integrate to CE length → `SE_force_length` → muscle force.

---

## Muscle Model Functions

### `CE_force_length_relation.m` — Active Force-Length
```
f_l = exp( log(c) * (|lce_norm - 1| / w)^3 )
```
A bell-shaped curve peaking at normalized CE length = 1 (`lopt`).

### `PE_force_length_relation.m` — Passive Force-Length
```
f_l = ((lce_norm - 1) / w)^2,  for lce_norm > 1
    = 0,                        otherwise
```
Passive resistance only when CE is stretched beyond optimum length.

### `SE_force_length_relation.m` — Series Elasticity (Tendon)
```
f_se = ((lse_norm - 1) / eref)^2,  for lse_norm > 1
     = 0,                           otherwise
```
Tendon force only when stretched beyond slack length.

### `CE_force_velocity_relation.m` — Hill Force-Velocity
```
Concentric (vce ≤ 0):  f_v = (vce + 1) / (1 - K * vce)
Eccentric  (vce > 0):  f_v = N + (N - 1) * (vce - 1) / (7.56*K*vce + 1)
```

### `CE_inverse_force_velocity_relation.m` — Inverse FV
Used inside the muscle model to compute CE velocity from the force balance.

---

## Parameters (`params.m`)

### Joint Control Parameters

| Joint | kp | kd | θ_desired |
|-------|----|----|-----------|
| Ankle | 1500 | 300 | π/2 rad |
| Hip | 750 | 250 | 0 rad |
| Shoulder | 30 | 5 | π rad |

Hip bang-bang: `T1 = 0.05 s`, `T2 = 0.1 s`

### Body Segment Anthropometry

| Segment | Length | Mass (computed) |
|---------|--------|----------------|
| Foot | 0.20 m | ~0.88 kg |
| Heel | 0.05 m | ~0.22 kg |
| Leg | 1.00 m | ~8.24 kg |
| Torso | 0.60 m | ~40.8 kg |
| Arm | 0.80 m | ~5.44 kg |

Mass computed as `density × L × W × H × 1000`.

### Shared Muscle Parameters

| Parameter | Value | Description |
|-----------|-------|-------------|
| `mp.preA` | 0.01 | Pre-activation |
| `mp.tau` | 0.01 s | Activation time constant |
| `mp.w` | 0.56 lopt | CE force-length width |
| `mp.c` | 0.05 | Residual force at ±width |
| `mp.N` | 1.5 Fmax | Eccentric force enhancement |
| `mp.K` | 5 | FV shape factor |
| `mp.eref` | 0.04 lslack | Tendon reference strain |

### Soleus (SOL) vs Tibialis Anterior (TA)

| Parameter | SOL | TA |
|-----------|-----|----|
| `Fmax` | 1500 N | 800 N |
| `lopt` | 0.05 m | 0.06 m |
| `vmax` | 12 lopt/s | 12 lopt/s |
| `lslack` | 0.40 m | 0.24 m |

### Disturbance

| Parameter | Value | Description |
|-----------|-------|-------------|
| `F_inp` | 70 N | Initial push force on torso |
| `g` | 9.81 m/s² | Gravity |

---

## References

- Millard, M. et al. (2013). *Flexing Computational Muscle: Modeling and Simulation of Musculotendon Dynamics.* ASME Journal of Biomechanical Engineering.
- Winter, D.A. (2009). *Biomechanics and Motor Control of Human Movement.* Wiley.
- Hogan, N. (1984). *Adaptive control of mechanical impedance by coactivation of antagonist muscles.* IEEE Transactions on Automatic Control.
